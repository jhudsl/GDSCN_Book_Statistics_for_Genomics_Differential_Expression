# Working in RStudio {#rstudio}

Now that you have [created a Workspace](creating-a-workspace.html#workspace), you can create an RStudio cloud environment. This will allow you to interface with data and perform genomics-based analyses with add on packages from the Bioconductor community.

## Launch RStudio Cloud Environment

1. Click on the name of the Workspace you just created. You should be routed to a link that looks like: `https://anvil.terra.bio/#workspaces/<billing-project>/<workspace-name>`.

1. On the top right, Click the gear icon to access your Cloud Environment options.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.gdde5ec9a4d_1_34")
    ```
    
1. You will see a list of costs because it costs a small amount of money to use cloud computing. Click "CUSTOMIZE".

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.gdde5ec9a4d_1_50")
    ```
    
1. Click on the first drop down menu to see what other software configurations are available.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.gdde5ec9a4d_1_11")
    ```
    
1. Scroll down and select RStudio from the Community-Maintained RStudio Environments section. 

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge08067d6e2_0_0")
    ```    
    
1. Leave everything else as-is. To create your RStudio Cloud Environment, click on the “CREATE” button.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge08067d6e2_0_34")
    ```    

1. Your Cloud Environment will be available in a few minutes after the cloud resources are provisioned and your software starts up. The upper right corner displays the status and should say “Creating” while resources are being provisioned.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge08067d6e2_0_6")
    ```    
    
1. After a few minutes, you will see the status change to “Running”.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge08067d6e2_0_10")
    ```    
    
1. Click on the “R” icon to launch RStudio.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge08067d6e2_0_43")
    ```    
    
1. You should now see the RStudio interface with information about the version printed to the console.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge08067d6e2_0_14")
    ```    

## Tour RStudio

Next, we will be using RStudio and the package `Glimma` to create interactive plots. See [this vignette](https://bioconductor.org/packages/release/bioc/vignettes/Glimma/inst/doc/limma_edger.html) for more information.

1. The Bioconductor team has created a very useful package to programmatically interact with Terra and Google Cloud. Install the `AnVIL` package. It will make some steps easier as we go along.

    ```{r, eval = FALSE}
BiocManager::install("AnVIL")
    ```

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_49")
    ```    

1. You can now quickly install precompiled binaries using the AnVIL package’s `install()` function. We will use it to install the `Glimma` package.

    ```{r, eval = FALSE}
AnVIL::install("Glimma")
    ```

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_56")
    ```  

1. Load some example data and save it as `dge`.

    ```{r, eval = FALSE}
dge <- readRDS(system.file("RNAseq123/dge.rds", package = "Glimma"))
    ```

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_56")
    ```  

1. The multidimensional scaling (MDS) plot is frequently used to explore differences in samples. When this data is MDS transformed, the first two dimensions explain the greatest variance between samples, and the amount of variance decreases monotonically with increasing dimension. The following code will launch a new window where you can interact with the MDS plot.

    ```{r, eval = FALSE}
glimmaMDS(dge)
    ```

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_70")
    ```  

1. Change the `colour_by` setting to "group" so you can easily distinguish between groups. In this data, the "group" is cell type.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_77")
    ```  

1. You can download the interactive html file by clicking on "Save As".

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g1204ed6da7f_0_0")
    ```  
    
1. You can also download plots and other files created directly in RStudio. To download the following plot, click on "Export" and save in your preferred format to the default directory. This saves the file in your cloud environment.

    ```{r, eval = FALSE}
limma::plotMDS(dge)
    ```

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g1204ed6da7f_0_12")
    ```  
    
1. You should see the plot in the "Files" pane.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g1204ed6da7f_0_19")
    ```  
    
1. Select this file and click "More" > "Export"

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g1204ed6db6a_0_0")
    ```  
    
1. Select "Download" to save the file to your local machine.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g1204ed6db6a_0_8")
    ```  
    
## Pause RStudio {#stopping}

1. The upper right corner reminds you that you are accruing cloud computing costs.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_84")
    ```  

1. You should minimize charges when you are not performing an analysis. You can do this by clicking on “Stop cloud environment”. This will release the CPU and memory resources for other people to use. Note that your work will be saved in the environment and continue to accrue a very small cost. Your instructor can delete these environments to stop costs accruing, so it's a good idea to save code or output somewhere else, such as GitHub or your local machine.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1BLTCaogA04bbeSD1tR1Wt-mVceQA6FHXa8FmFzIARrg/edit#slide=id.g11f12bc99af_0_91")
    ```  

## Delete RStudio Cloud Environment

1. [Stopping](#stopping) your cloud environment only pauses your work. When you are ready to delete the cloud environment, click on the gear icon in the upper right corner to “Update cloud environment”.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge1182913a6_0_41")
    ```  
    
1. Click on “Delete Environment Options”.

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge1182913a6_0_20")
    ```  

1. If you are certain that you do not need the data and configuration on your disk, you should select "Delete everything, including persistent disk".

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge1182913a6_0_46")
    ```  

1. Select "DELETE".

    ```{r, echo=FALSE, fig.alt='Screenshot of '}
ottrpal::include_slide("https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw/edit#slide=id.ge1182913a6_0_51")
    ```  

## Video Guide

In addition to the steps above, you can review this video guide on how to launch RStudio on AnVIL.

<iframe src="https://drive.google.com/file/d/1v72ZG8JIRDUaewFQgGfcCO_qoM4eYmYX/preview" width="640" height="360" allow="autoplay"></iframe>

The slides for this tutorial are are located [here](https://docs.google.com/presentation/d/1eypYLLqD11-NwHLs4adGpcuSB07dYEJfAaALSMvgzqw).

```{r}
sessionInfo()
```
